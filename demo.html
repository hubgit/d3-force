<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>d3-force demo</title>
    <script src="../webcomponentsjs/webcomponents.js"></script>
    <link rel="import" href="d3-force.html">

    <style>
        html, body {
            height: 100%;
            width: 100%;
            overflow: hidden;
            margin: 0;
        }
    </style>
</head>
<body unresolved>
    <d3-force></d3-force>

    <script>
    var spotify = {
        related: function(source) {
            return new Promise(function(respond, reject) {
                var url = 'https://api.spotify.com/v1/artists/' + source.id + '/related-artists';
                var request = new XMLHttpRequest();
                request.open('GET', url);
                request.responseType = 'json';
                request.onload = function() {
                    respond(this.response.artists.map(function(artist) {
                        return ({
                            source: source,
                            target: artist
                        });
                    }));
                };
                request.send();
            }.bind(this));
        }
    };

    window.addEventListener('polymer-ready', function(e) {
        var graph = document.querySelector('d3-force');

        graph.nodeSize = function(d) {
            return 10 + ((d.popularity / 40) * 5) + 'px';
        };

        graph.expand = function(source) {
            return new Promise(function(respond, reject) {
                spotify.related(source).then(function(items) {
                    graph.addLinks(items);
                })
            });
        };

        var source = {
            id: '6WoTvA9qinpHtSRJuldYh6',
            name: 'The Fall',
            popularity: 52,
            selected: true,
        }

        spotify.related(source).then(function(items) {
            graph.addLinks(items);
        })
    });
    </script>
</body>
</html>
